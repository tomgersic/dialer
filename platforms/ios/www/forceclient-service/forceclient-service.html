<link rel="import" href="../components/polymer/polymer.html">

<polymer-element name="forceclient-service">
  <script>
  (function() {
    var firstName = 'John';
    var lastName = 'Smith';
    var client = new forcetk.Client();


    var OfflineTracker = Backbone.Model.extend({
        initialize: function() {
            var that = this;
            this.set("isOnline", navigator.onLine);
            document.addEventListener("offline", function() {
                console.log("Received OFFLINE event");
                that.set("isOnline", false);
            }, false);
            document.addEventListener("online", function() {
                console.log("Received ONLINE event");
                // User decides when to go back online
            }, false);
        }
    });

    var offlineTracker;

    Polymer({
      ready: function() {
         this.firstName = firstName;
         this.lastName = lastName;
         this.client = client;
         this.offlineTracker = new OfflineTracker({isOnline: true});
      },
      authenticateUser:function(context,successHandler,errorHandler) {
        //alert("Authenticate User Called");

       

        // Get salesforce mobile sdk OAuth plugin
        var oauthPlugin = cordova.require("com.salesforce.plugin.oauth");

        // Call getAuthCredentials to get the initial session credentials
        oauthPlugin.getAuthCredentials(
            // Callback method when authentication succeeds.
            function (creds) {

                Force.init(creds, null, client, cordova.require("com.salesforce.plugin.oauth").forcetkRefresh);
                              
                
                // Create forcetk client instance for rest API calls
                client.setSessionToken(creds.accessToken, "v31.0", creds.instanceUrl);
                // Call success handler and handover the forcetkClient
                successHandler(context,client);

            },
            function (error) {
                alert('Failed to authenticate user: ' + error);
            }
        );
      }
    });
  })();
  </script>
</polymer-element>